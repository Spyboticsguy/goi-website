<!DOCTYPE html>
<html lang="en">

<head>
  <title>Best Boats</title>
  <link rel="shortcut icon" href="blimp-icon.png">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link rel="stylesheet" href="tabs.css"> -->
  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script> -->


  <!-- 
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
    crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script> 
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
  -->

  <link rel="stylesheet" href="deps/bootstrap.min.css">
  <script src="deps/jquery-3.4.1.slim.min.js"></script>
  <script src="deps/popper.min.js"></script>
  <script src="deps/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>

  <script src="utils.js"></script>
  <script src="docsapi.js"></script>
  <script src="damageCalculations.js"></script>
  <script src="matchStatistics.js"></script>
  <script src="mapSpawns.js"></script>
  <script src="shipBuilder.js"></script>
  <link rel="stylesheet" href="css/style.css">
  <!-- <script defer src="https://use.fontawesome.com/releases/v5.6.3/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
     crossorigin="anonymous"></script>
   <script defer src="https://use.fontawesome.com/releases/v5.6.3/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
     crossorigin="anonymous"></script> -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"
    crossorigin="anonymous">

</head>

<body>


  <div class="wrapper">
    <!-- Sidebar  -->
    <nav id="sidebar">
      <div class="sidebar-header">
        <h3>Guns of Icarus Info</h3>
      </div>
      <div class="sidebar-header collapsed">
        <h3><i class="fas fa-atom"></i></h3>
      </div>

      <ul class="list-unstyled components">

        <!-- <li id="shipBuildsLink" data-show="#shipBuilds">
          <a href="#" class="active">
            <i class="fas fa-ship"></i>
            Ship builds
          </a>
        </li> -->


        <li id="matchAnalysisLink" data-show="#matchAnalysis">
          <a href="#matchAnalysis">
            <i class="fas fa-glasses"></i>
            Match history analysis
          </a>
        </li>
        <li id="matchesLink" data-show="#matchDatabase">
          <a href="#matchDatabase">
            <i class="fas fa-book"></i>
            Competative match database
          </a>
        </li>
        <li id="matchSubmissionLink" data-show="#matchSubmission">
          <a href="#matchSubmission">
            <i class="fas fa-pen-nib"></i>
            Submit match to history
          </a>
        </li>

        <li id="shipBuilderLink" data-show="#shipBuilder">
          <a href="#shipBuilder">
            <i class="fas fa-hammer"></i>
            Ship builder
          </a>
        </li>

        <li id="damageCalculatorLink" data-show="#damageCalculator">
          <a href="#damageCalculator" class="active">
            <i class="fas fa-bomb"></i>
            Damage calculator
          </a>
        </li>

        <li id="projectileArcsLink" data-show="#projectileArcs">
          <a href="#projectileArcs">
            <i class="fas fa-meteor"></i>
            Projectile arcs
          </a>
        </li>
        <li id="mapSpawnsLink" data-show="#spawns">
          <a href="#spawns">
            <i class="fas fa-map"></i>
            <!-- <i class="fas fa-random"></i> -->
            Maps
          </a>
        </li>
        <li id="aboutLink" data-show="#about">
          <a href="#about">
            <i class="far fa-question-circle"></i>
            About
          </a>
        </li>

      </ul>

    </nav>
    <!-- Page Content  -->
    <div id="content" class="container-fluid">

      <!-- Ship database -->
      <div id="shipBuilds" class="content-panel" style="display:none">

        <div class="row row-margin">
          <div class="col-sm-6">
            <div class="input-group">
              <div class="input-group-prepend">
                <div class="input-group-text">Filter</div>
              </div>
              <select class="form-control" id="shipFilterModeSelect" autocomplete="off">
                <option>Include</option>
                <option>Exclude</option>
              </select>
              <select class="form-control" id="shipFilterSelect" autocomplete="off">
                <option>All</option>
                <option selected>Ship</option>
                <option>Build name</option>
                <option>Guns</option>
                <option>Strong VS</option>
                <option>Weak VS</option>
              </select>
              <input type="text" class="form-control" id="shipFilterText" placeholder="filter substring">
              <!-- <div class="input-group-append">
                  <button id="shipFilterBtn" class="btn btn-primary">Filter</button>
                </div> -->
            </div>
          </div>

        </div>

        <div class="row">
          <!-- <div class="col"></div> -->
          <div class="col">
            <table id="shipsTable" class="table table-bordered">
            </table>
          </div>

        </div>

      </div>

      <!-- Match history analysis -->
      <div id="matchAnalysis" class="content-panel" style="display:none">
        <h1>Match history statistics</h1>
        <div class="input-group" style="width:440px">
          <div class="input-group-prepend">
            <div class="input-group-text">Include matches from</div>
          </div>
          <input type="text" class="form-control" id="graphDateFilterStartText" placeholder="2019-01-01" autocomplete="off">
          <div class="input-group-text">to</div>
          <input type="text" class="form-control" id="graphDateFilterEndText" placeholder="today" autocomplete="off">
          

        </div>
        <br>

        <div class="row row-margin">
          <div class="col-sm-4">
            <div class="input-group">
              <div class="input-group-prepend small">
                <div class="input-group-text">Ship</div>
              </div>
              <select class="form-control" id="statsShipSelect" autocomplete="off">
                <option>Goldfish</option>
                <option>Junker</option>
                <option>Squid</option>
                <option>Galleon</option>
                <option>Spire</option>
                <option selected>Pyramidion</option>
                <option>Mobula</option>
                <option>Magnate</option>
                <option>Crusader</option>
                <option>Judgement</option>
                <option>Corsair</option>
                <option>Shrike</option>
                <option>Stormbreaker</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-s-3">
            <canvas id="bubbleChart" width="600" height="400"></canvas>
          </div>
        </div>
        <hr>
        <div class="row">
          <div class="col-s-3">
              <canvas id="prChart" width="250" height="250"></canvas>
          </div>
          <div class="col-s-3">
              <canvas id="wlChart" width="250" height="250"></canvas>
          </div>
        </div>
        <hr>
        <div class="row">
          <div class="col-s-5">
            <canvas id="winRatioEnemyChart" width="400" height="400"></canvas>
          </div>
          <div class="col-s-2">
            &nbsp &nbsp &nbsp
          </div>
      
          <div class="col-s-5">
            <canvas id="winRatioAllyChart" width="400" height="400"></canvas>
          </div>
        </div>
      </div>

      <!-- Match Database -->
      <div id="matchDatabase" class="content-panel" style="display:none">
        <div class="row row-margin">
          <div class="col-sm-6">
            <div class="input-group">
              <div class="input-group-prepend">
                <div class="input-group-text">Filter</div>
              </div>
              <select class="form-control" id="matchFilterModeSelect" autocomplete="off">
                <option>Include</option>
                <option>Exclude</option>
              </select>
              <select class="form-control" id="matchFilterSelect" autocomplete="off">
                <option>All</option>
                <option>Date after (DDMMYYYY)</option>
                <option>Date before (DDMMYYYY)</option>
                <option>Event</option>
                <option>Ship</option>
                <option>Pilot</option>
              </select>
              <input type="text" class="form-control" id="matchFilterText" placeholder="filter substring">
              <!-- <div class="input-group-append">
                  <button id="shipFilterBtn" class="btn btn-primary">Filter</button>
                </div> -->
            </div>
          </div>
        </div>

        <!-- <button id="matchAddFilterBtn" class="btn btn-primary">Add another filter</button> -->
        <div class="row">
          <!-- <div class="col"></div> -->
          <div class="col">
            <table id="matchTable" class="table table-bordered">
            </table>
          </div>
        </div>
      </div>

      <!-- Match Submissions -->
      <div id="matchSubmission" class="content-panel" style="display:none">
        <p>Here you can submit a match to the database.</p>
        <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSf8Fyrz4MRAJ8MoDke7it8zB_ihARWv12TBQMtIKstVY3cGXw/viewform?embedded=true"
          width="640" height="2317" frameborder="0" marginheight="0" marginwidth="0">Loading…</iframe>
      </div>

      <!-- Ship builder -->
      <div id="shipBuilder" class="content-panel" style="display:none">
        <h3>UNDER DEVELOPMENT</h3>
        <h3>Ship builder</h3>

        <p>Build can be shared via the current URL or by copying and pasting in the textfield below and pressing import/export.</p>
        <div class="input-group">
          <div class="input-group-prepend">
            <div class="input-group-text">Import build</div>
          </div>
          <input type="text" id="shipBuildImportText" class="form-control" placeholder="" autocomplete="off">
          <div class="input-group-append">
              <button id="shipBuildImportButton" class="btn btn-primary" type="button">Import</button>
              <button id="shipBuildExportButton" class="btn btn-info" type="button">Export</button>
          </div>
        </div>

        <br>
        
        <h3>Loadout</h3>

        <div class="input-group" style="width:200px;">
          <div class="input-group-prepend">
            <div class="input-group-text">Ship</div>
          </div>
          <select class="form-control" id="shipBuildShipSelection" autocomplete="off">
            <!-- <option>Mobula</option>       -->
          </select>
        </div>
        


        <br>
        <div class="my-col" id="weaponSelections">
          <b>Ship Loadout</b>
          <div class="input-group">
            <div class="input-group-prepend">
              <div class="input-group-text">Weapon 1</div>
            </div>
            <select class="form-control" id="shipBuildGun1" autocomplete="off"></select>
            <select class="form-control" autocomplete="off"></select>
          </div>
          <!-- <br> -->
          <div class="input-group">
            <div class="input-group-prepend">
              <div class="input-group-text">Weapon 2</div>
            </div>
            <select class="form-control" id="shipBuildGun2" autocomplete="off"></select>
            <select class="form-control" autocomplete="off"></select>
          </div>
          <!-- <br> -->
          <div class="input-group">
            <div class="input-group-prepend">
              <div class="input-group-text">Weapon 3</div>
            </div>
            <select class="form-control" id="shipBuildGun3" autocomplete="off"></select>
            <select class="form-control" autocomplete="off"></select>
          </div>
          <!-- <br> -->
          <div class="input-group">
            <div class="input-group-prepend">
              <div class="input-group-text">Weapon 4</div>
            </div>
            <select class="form-control" id="shipBuildGun4" autocomplete="off"></select>
            <select class="form-control" autocomplete="off"></select>
          </div>
          <!-- <br> -->
          <div class="input-group">
            <div class="input-group-prepend">
              <div class="input-group-text">Weapon 5</div>
            </div>
            <select class="form-control" id="shipBuildGun5" autocomplete="off"></select>
            <select class="form-control" autocomplete="off"></select>
          </div>
          <!-- <br> -->
          <div class="input-group">
            <div class="input-group-prepend">
              <div class="input-group-text">Weapon 6</div>
            </div>
            <select class="form-control" id="shipBuildGun6" autocomplete="off"></select>
            <select class="form-control" autocomplete="off"></select>
          </div>
        </div>

        <div class="my-col" id="crewLoadouts">
          <b>Crew Loadout</b>
        
          <div class="input-group">
            <div class="input-group-prepend">
              <!-- <div class="input-group-text">Crew</div> -->
            </div>
        
            <div>
              <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                <img src="loadout-images/Noclass.jpg" width="35" height="35" class="rounded">
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item"><img src="loadout-images/Pilot.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Gunner.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Engineer.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Noclass.jpg" width="40" height="40"></button></a>
              </div>
            </div>
        
            <div>
              <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                <img src="loadout-images/Spyglass.jpg" width="35" height="35" class="rounded">
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item"><img src="loadout-images/Spyglass.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Rangefinder.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Claw.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Kerosene.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Moonshine.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Hydrogen.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Vent.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Chute.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Bumpers.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Tar.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Sail.jpg" width="40" height="40"></button></a>
              </div>
            </div>
        
            <div>
              <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                <img src="loadout-images/Kerosene.jpg" width="35" height="35" class="rounded">
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item"><img src="loadout-images/Spyglass.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Rangefinder.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Claw.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Kerosene.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Moonshine.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Hydrogen.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Vent.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Chute.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Bumpers.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Tar.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Sail.jpg" width="40" height="40"></button></a>
              </div>
            </div>
        
            <div>
              <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                <img src="loadout-images/Hydrogen.jpg" width="35" height="35" class="rounded">
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item"><img src="loadout-images/Spyglass.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Rangefinder.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Claw.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Kerosene.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Moonshine.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Hydrogen.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Vent.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Chute.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Bumpers.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Tar.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Sail.jpg" width="40" height="40"></button></a>
              </div>
            </div>
        
            <div>
              <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                <img src="loadout-images/Mallet.jpg" width="35" height="35" class="rounded">
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item"><img src="loadout-images/Mallet.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Spanner.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Pipe.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Failsafe.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Extinguisher.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Chemspray.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Buff.jpg" width="40" height="40"></button></a>
              </div>
            </div>
        
            <div>
              <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                <img src="loadout-images/Spanner.jpg" width="35" height="35" class="rounded">
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item"><img src="loadout-images/Mallet.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Spanner.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Pipe.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Failsafe.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Extinguisher.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Chemspray.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Buff.jpg" width="40" height="40"></button></a>
              </div>
            </div>
        
            <div>
              <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                <img src="loadout-images/Extinguisher.jpg" width="35" height="35" class="rounded">
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item"><img src="loadout-images/Mallet.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Spanner.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Pipe.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Failsafe.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Extinguisher.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Chemspray.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Buff.jpg" width="40" height="40"></button></a>
              </div>
            </div>
        
            <div>
              <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                <img src="loadout-images/Charged.jpg" width="35" height="35" class="rounded">
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item"><img src="loadout-images/Normal.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Lochnagar.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Heavy.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Incendiary.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Burst.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Greased.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Lesmok.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Heatsink.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Charged.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Extended.jpg" width="40" height="40"></button></a>
              </div>
            </div>
        
            <div>
              <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                <img src="loadout-images/Greased.jpg" width="35" height="35" class="rounded">
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item"><img src="loadout-images/Normal.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Lochnagar.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Heavy.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Incendiary.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Burst.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Greased.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Lesmok.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Heatsink.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Charged.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Extended.jpg" width="40" height="40"></button></a>
              </div>
            </div>
        
            <div>
              <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                <img src="loadout-images/Lesmok.jpg" width="35" height="35" class="rounded">
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item"><img src="loadout-images/Normal.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Lochnagar.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Heavy.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Incendiary.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Burst.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Greased.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Lesmok.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Heatsink.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Charged.jpg" width="40" height="40"></button></a>
                <a class="dropdown-item"><img src="loadout-images/Extended.jpg" width="40" height="40"></button></a>
              </div>
            </div>
          </div>
        </div>

        

        <br>
        <br>
        <h3>Ship preview</h3>
        <br>
        <div class="my-col img-canvas-container" id="shipContainer">
          <b>Drag or scroll to pan or zoom image.</b>
          <br>
          <b>Note: Only mobula works here so far.</b>
          <br>
          <img id="shipBuilderImage" class="img" src="ship-images/corsair-gundeck-small.png" style="display:none" />
          <canvas id="shipBuilderCanvas" width="400" height="427" style="border-style:solid;">Your browser does not support the HTML5 canvas tag.</canvas>
          <canvas id="shipBuilderCanvasOffscreen" width="400" height="427" style="display:none">Your browser does not support the HTML5 canvas tag.</canvas>
      
          <div id="shipBuildGunSelector" class="btn-group-vertical" role="group">
            <button type="button" class="btn btn-secondary">Left</button>
            <button type="button" class="btn btn-secondary">Middle</button>
            <button type="button" class="btn btn-secondary">Right</button>
          </div>
      
        </div>
      
        

        <div class="my-col">
          <br>
          <!-- <br> -->
            <div id="rangeMapContainer" class="img-canvas-container">
                <img id="rangeImage" class='img' src="map-images/dunes.png" width="400" height="400" />
                <canvas id="rangeCanvas" width="400" height="400">Your browser does not support the HTML5 canvas tag.</canvas>
                <canvas id="rangeCanvasOffscreen" width="400" height="400" style="display:none">Your browser does not support the HTML5 canvas tag.</canvas>
              </div>
              
              <img class='img' src="ship-images/legend.png" width="114" height="179" />
        </div>
        
        

        
        <br> 
        
        <br>
          
          
        </div>
        

      <!-- Gunnery calculator -->
      <div id="damageCalculator" class="content-panel" style="display:block">
        <h1>Damage numbers</h1>
        <div class="row row-margin">
          <div class="col-sm-4">
            <div class="input-group">
              <div class="input-group-prepend small">
                <div class="input-group-text">Gun</div>
              </div>
              <select class="form-control" id="gunSelect" autocomplete="off">
                <option>Artemis</option>
                <option>Light Flak</option>
                <option>Gatling</option>
                <option>Flamethrower</option>
                <option>Light Carronade</option>
                <option>Harpoon</option>
                <option>Flare</option>
                <option>Mercury</option>
                <option>Mortar</option>
                <option>Banshee</option>
                <option>Mine</option>
                <option>Hades</option>
                <option>Aten Lens Array</option>
                <option>Heavy Flak Mk. I</option>
                <option>Heavy Flak Mk. II</option>
                <option>Hwatcha</option>
                <option>Heavy Carronade</option>
                <option>Lumberjack</option>
                <option>Minotaur</option>
                <option>Nemesis</option>
              </select>
            </div>
          </div>
        </div>

        <div class="row row-margin" id="damageCalcAmmoInput">
          <div class="col-sm-4">
            <div class="input-group">
              <div class="input-group-prepend small">
                <div class="input-group-text">Ammo</div>
              </div>
              <select class="form-control" id="ammoSelect" autocomplete="off">
                <option>Normal</option>
                <option>Lochnagar</option>
                <option>Heavy</option>
                <option>Incendiary</option>
                <option>Burst</option>
                <option>Greased</option>
                <option>Lesmok</option>
                <option>Heatsink</option>
                <option>Charged</option>
                <option>Extended</option>
              </select>
            </div>
          </div>
        </div>


        <div id="damageCalcCustomAmmoInput" style="display:none">
          <h5>Custom ammo</h5>
          <p>Enter values as multipliers, ie. 1.1 is +10%, 0.9 is -10%.</p>

          <div class="my-col">
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Damage</div>
              </div>
              <input type="text" id="customAmmoInputDamage" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Rate of Fire</div>
              </div>
              <input type="text" id="customAmmoInputROF" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Clip size</div>
              </div>
              <input type="text" id="customAmmoInputClipSize" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Direct damage</div>
              </div>
              <input type="text" id="customAmmoInputDirectDmg" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">AoE damage</div>
              </div>
              <input type="text" id="customAmmoInputAoEDamage" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>

          </div>
          <!-- <br> -->
          <div class="my-col">
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Projectile speed</div>
              </div>
              <input type="text" id="customAmmoInputSpeed" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Arming time</div>
              </div>
              <input type="text" id="customAmmoInputArmingTime" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Range</div>
              </div>
              <input type="text" id="customAmmoInputRange" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Jitter</div>
              </div>
              <input type="text" id="customAmmoInputArmingJitter" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">AoE radius</div>
              </div>
              <input type="text" id="customAmmoInputAoERadius" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
          </div>

          <div class="my-col">
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Rotation speed</div>
              </div>
              <input type="text" id="customAmmoInputArmingRotationSpeed" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Rotational arcs</div>
              </div>
              <input type="text" id="customAmmoInputArmingRotationalArcs" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>

            <br>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Fire modifier</div>
              </div>
              <input type="text" id="customAmmoInputArmingRotationalFireChance" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Fire damage</div>
              </div>
              <input type="text" id="customAmmoInputArmingRotationalFireDamage" class="form-control" placeholder="" autocomplete="off" value="0">
            </div>
          </div>

          
        </div>

        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="damageCalcCustomAmmoCheck" autocomplete="off">
          <label class="form-check-label" for="damageCalcCustomAmmoCheck">Use testing ammo</label>
        </div>

        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="buffedCheckbox" autocomplete="off">
          <label class="form-check-label" for="buffedCheckbox">Buffed</label>
        </div>

        <div id="laserExtras" style="display:none">
          <div class="form-group form-row align-items-center">
            <label for="distanceRange">Target distance: &nbsp; </label>
            <div>
              <input type="range" min="0" max="1000" step="10" class="form-control-range" id="distanceRange" data-textfield="#distanceText">
            </div>
            <div class="col-sm-1">
              <input type="text" class="form-control" placeholder="[0-1123]" id="distanceText" disabled>
            </div>
          </div>
  
          <div class="form-group form-row align-items-center">
            <label for="distanceRange">Time shooting: &nbsp; &nbsp;</label>
            <div>
              <input type="range" min="0" max="1000" step="0.5" class="form-control-range" id="timeRange" data-textfield="#timeText">
            </div>
            <div class="col-sm-1">
              <input type="text" class="form-control" placeholder="[0-1123]" id="timeText" disabled>
            </div>
          </div>
        </div>
        
        
        <table id="gunTable" class="fixed table table-bordered">
          <tr>
            <th>Range (m)</th>
            <th>Arming distance (m)</th>
            <th>Seconds / clip (s)</th>
            <th>Clip size</th>
            <th>AOE (m)</th>
          </tr>
          <tbody id="gunContent"></tbody>
        </table>

        <table id="damageTotalTable" class="fixed fist-wide table table-bordered">
          <tr>
            <th class="medium">Damage (primary + secondary)</th>
            <th class="medium">
              Armor
              <br>
              <select id="armorUnitSelect" class="form-control" autocomplete="off">
                <option>HP</option>
                <option>Mallets</option>
                <option>Galleon A.</option>
                <option>Pyramidion A.</option>
                <option>Stormbreaker A.</option>
              </select>
            </th>
            <th class="medium">
              Hull
              <br>
              <select id="hullUnitSelect" class="form-control" autocomplete="off">
                <option>HP</option>
                <option>Galleon H.</option>
                <option>Pyramidion H.</option>
                <option>Stormbreaker H.</option>
              </select>
            </th>
            <th class="medium">
              Balloon
              <br>
              <select id="balloonUnitSelect" class="form-control" autocomplete="off">
                <option>HP</option>
                <option>B. Mallets</option>
                <option>Balloons</option>
              </select>
            </th>
            <th class="medium">
              Component
              <br>
              <select id="componentUnitSelect" class="form-control" autocomplete="off">
                <option>HP</option>
                <option>Mallets</option>
                <option>Light Guns</option>
                <option>Heavy Guns</option>
                <option>Light Engines</option>
                <option>Heavy Engines</option>
              </select>
            </th>
          </tr>
          <tbody id="damageTableContent"></tbody>
        </table>

      </div>

      <!-- Arc calculator -->
      <div id="projectileArcs" class="content-panel" style="display:none">
        <h1>Projectile arcs and aiming</h1>
        <div class="row row-margin">
          <div class="col-sm-4">
            <div class="input-group">
              <div class="input-group-prepend small">
                <div class="input-group-text">Gun</div>
              </div>
              <select class="form-control" id="arcGunSelect" autocomplete="off">
                <option>Lumberjack</option>
                <!-- <option>Hades</option> -->
                <option>Heavy Flak Mk. II</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row row-margin">
          <div class="col-sm-4">
            <div class="input-group">
              <div class="input-group-prepend small">
                <div class="input-group-text">Ammo</div>
              </div>
              <select class="form-control" id="arcAmmoSelect" autocomplete="off">
                <option>Normal</option>
                <option>Lochnagar</option>
                <option>Heavy</option>
                <option>Incendiary</option>
                <option>Burst</option>
                <option>Greased</option>
                <option>Lesmok</option>
                <option>Heatsink</option>
                <option>Charged</option>
                <option>Extended</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row row-margin">
          <div class="col-sm-4">
            <div class="input-group">
              <div class="input-group-prepend small">
                <div class="input-group-text">Map</div>
              </div>
              <select class="form-control" id="arcMapSelect" autocomplete="off">
                <option>Dunes</option>
                <option selected>Fjords</option>
              </select>
            </div>
          </div>
        </div>
        <!-- <h5>Drag the points on either of the first images to change altitudes and distances.</h5>¨ -->
      
        <div class="sbs-container">
          <div id="mapContainer" class="img-canvas-container sbs-column">
            <b>Select ship positions (distance)</b>
            <br>
            <img id="mapImage" class='img' src="map-images/fjords.png" width="400" height="400" />
            <canvas id="mapCanvas" width="400" height="400">Your browser does not support the HTML5 canvas tag.</canvas>
          </div>
        
          <div class="sbs-column">
            <b>Projectile arc side view. Height changeable.</b>
            <br>
            <canvas id="arcCanvas" width="400" height="400" style="border:1px solid #d3d3d3;">
              Your browser does not support the HTML5 canvas tag.</canvas>
          </div>
        </div>
        
        
        <div class="sbs-container">
          <div class="sbs-column">
        
            <b>Gunner view, aim with the red line</b>
            <br>
            <div id="gunContainer" class="img-canvas-container column">
              <img id="gunImage" class='img' src="gun-images/lumberjack.png" width="334" height="400" />
              <canvas id="gunCanvas" width="334" height="400">
                Your browser does not support the HTML5 canvas tag.</canvas>
            </div>
          </div>
          
          <div class="sbs-column">
              <b>Data</b>
              <table id="arcDataTable" class="fixed table table-bordered">
                <tr>
                  <th class="medium">Time to hit</th>
                  <td id="arcTableTime">10m</td>
                </tr>
                <tr>
                  <th class="medium">Distance</th>
                  <td id="arcTableDistance">10s</td>
                </tr>
                <tr>
                  <th class="medium">Aim angle over target</th>
                  <td id="arcTableAngleRel">10</td>
                </tr>
                <tr>
                  <th class="medium">Aim angle over horizon</th>
                  <td id="arcTableAngleAbs">10</td>
                </tr>
              </table>
          </div>
        </div>
      </div>

      <div id="spawns" class="content-panel" style="display:none">
        <div class="input-group" style="width:400px;">
          <div class="input-group-prepend">
            <div class="input-group-text">Map</div>
          </div>
          <select class="form-control" id="spawnMapSelect" autocomplete="off">
          </select>
          <div class="input-group-append">
            <button id="randomMapButton" class="btn btn-primary">Randomize map</button>
          </div>
        </div>
      
        <img id="spawnImage" src="" width="700" height="700">
        <p>Credit to Nerdhector for creating spawn position images.</p>
      </div>

      <!-- About -->
      <div id="about" class="content-panel" style="display:none">
        <h3>About</h3>
        <p>
          Database can be found here: <br><a href="https://docs.google.com/spreadsheets/d/1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g/edit?usp=sharing">https://docs.google.com/spreadsheets/d/1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g/edit?usp=sharing</a>.
        </p>
        <p>
          Contact: <br> jjeessppeer+GoI@gmail.com
        </p>
        <p>Please send an email or a discord message if you feel like you know something cool that could be added to
          the site.</p>
        <p>
          If you for some reason wanna see the source i can send you a link.
        </p>
      </div>


    </div>


  </div>
  </div>


  <script>

    var match_dataset = null;
    var gun_dataset = null;
    var ammo_dataset = null;
    var damage_dataset = null;
    var ship_dataset = null;
    var tool_dataset = null;
    var component_dataset = null;
    var crosshair_dataset = null;
    var map_dataset = null;
    var ship_guns_dataset = null;

    $(document).ready(function () {

      $("li").on("click", sidebarLinkClicked);
      $("#shipFilterSelect,#shipFilterModeSelect").on("change", shipFilterSubmitted);
      $("#shipFilterText").on("input keydown keyup mousedown mouseup select contextmenu drop", shipFilterSubmitted);
      $("#matchFilterSelect,#matchFilterModeSelect").on("change", matchFilterSubmitted);
      $("#matchFilterText").on("input keydown keyup mousedown mouseup select contextmenu drop", matchFilterSubmitted);
      
      $('#mapImage').on('dragstart', function(event) { event.preventDefault(); });
      
      initializeDamageCalculator();

      // Load datasets
      loadDatasetFromSheet("1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g", 2, function (dataset) {
        dataset.sortDatasetContent("Date of match", Date.parse);
        match_dataset = dataset;
        setMatchTableItems(match_dataset.getDatasetRows());
        matchFilterSubmitted();
      });
      loadDatasetFromSheet("1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g", 4, function (dataset) {
        gun_dataset = dataset;
      });
      loadDatasetFromSheet("1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g", 5, function (dataset) {
        ammo_dataset = dataset;
      });
      loadDatasetFromSheet("1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g", 6, function (dataset) {
        damage_dataset = dataset;
      });
      loadDatasetFromSheet("1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g", 7, function (dataset) {
        tool_dataset = dataset;
      });
      loadDatasetFromSheet("1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g", 8, function (dataset) {
        component_dataset = dataset;
      });
      loadDatasetFromSheet("1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g", 9, function (dataset) {
        ship_dataset = dataset;
      });
      loadDatasetFromSheet("1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g", 10, function (dataset) {
        map_dataset = dataset;
      });
      loadDatasetFromSheet("1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g", 11, function (dataset) {
        crosshair_dataset = dataset;
      });
      loadDatasetFromSheet("1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g", 12, function (dataset) {
        ship_guns_dataset = dataset;
      });


      // Aim calculator variables
      var start_point = [100, 100, 100];
      var target_point = [200, 200, 100];
      updateArcPanel(start_point, target_point);

      // Aim calculator events
      $("#mapCanvas").on("mousemove mousedown", function(e){
        if (e.buttons != 1) return;
        let click_pos = [e.pageX - $(this).offset().left, this.width - e.pageY + $(this).offset().top];
        
        if (dist2D(target_point, click_pos) < dist2D(start_point, click_pos)){
          target_point[0] = click_pos[0];
          target_point[1] = click_pos[1];
        }
        else{
          start_point[0] = click_pos[0];
          start_point[1] = click_pos[1];
        }
        updateArcPanel(start_point, target_point);
      });

      $("#arcCanvas").on("mousemove mousedown", function(e){
        if (e.buttons != 1) return;
        let click_pos = [20 + e.pageX - $(this).offset().left, this.width - e.pageY + $(this).offset().top];
        let target_2d = [dist2D(target_point, start_point) + 20, target_point[2]];
        let start_2d = [20, start_point[2]];
        
        if (dist2D(target_2d, click_pos) < dist2D(start_2d, click_pos)){
          target_point[2] = click_pos[1];
        }
        else{
          start_point[2] = click_pos[1];
        }
        updateArcPanel(start_point, target_point);
      });
      $("#arcAmmoSelect").on("change", function(){updateArcPanel(start_point, target_point);});

      $("#arcGunSelect").on("change", function () {
        let gun_srcs = { "Lumberjack": "gun-images/lumberjack.png", "Heavy Flak Mk. II": "gun-images/flak.png", "Hades": "gun-images/lumberjack.png" };
        let gun_image = $("#gunImage")[0];
        gun_image.src = gun_srcs[$(this).val()];
        runOnComplete(gun_image, function(gun_image){
          let gun_canvas = document.querySelector("#gunCanvas");
          let image_height = 400;
          let image_scale = image_height / gun_image.naturalHeight;
          gun_image.height = image_height;
          gun_canvas.height = image_height;
          gun_image.width = gun_image.naturalWidth * image_scale;
          gun_canvas.width = gun_image.naturalWidth * image_scale;
          updateArcPanel(start_point, target_point);
        })
      });
      $("#arcMapSelect").on("change", function(){
        let map_srcs = {"Dunes": "map-images/dunes.png", "Fjords": "map-images/fjords.png"};
        $("#mapImage").attr("src", map_srcs[$(this).val()]);
        updateArcPanel(start_point, target_point);
        });

      updateArcPanel(start_point, target_point);

      
      
      //--- Ship builder ---
      initializeShipBuilder();

      //--- Match statistics ---
      initializeMatchStatistics();

      initializeSpawns();
      
      
      $("[data-show='#" + window.location.hash.substr(1).split("?")[0] + "']").trigger("click");


    });


    function updateArcPanel(start_point, target_point){
      if (!(gun_dataset && ammo_dataset && ship_dataset && crosshair_dataset && map_dataset)) {
        console.log("Still loading");
        setTimeout(function(){ updateArcPanel(start_point, target_point); }, 1000);
        return;
      }

      // start_point and target_point are 3d points with canvas-local coordinates
      // must be scaled to world coords
      // Get world coords
      let map_image = document.querySelector("#mapImage");
      let map_scale = map_dataset.getCellByString($("#arcMapSelect").val(), "Name", "Map scale (m/px)") / (map_image.width / map_image.naturalWidth);
      // console.log(map_dataset.getCellByString($("#arcMapSelect").val(), "Name", "Map scale (m/px)"))
      let arc_scale = 10;

      let world_target = [target_point[0]*map_scale, target_point[1]*map_scale, target_point[2]*arc_scale];
      let world_start = [start_point[0]*map_scale, start_point[1]*map_scale, start_point[2]*arc_scale];
      
      // Gun and ammo data
      let gun_type = $("#arcGunSelect").val();
      let ammo_type = $("#arcAmmoSelect").val();

      let speed = gun_dataset.getCellByString(gun_type, "Alias", "Projectile speed") * ammo_dataset.getCellByString(ammo_type, "Alias", "Projectile speed");
      // let drop = gun_dataset.getCellByString(gun_type, "Alias", "Shell drop") * ( 2 - ammo_dataset.getCellByString(ammo_type, "Alias", "Lift"));
      let drop = gun_dataset.getCellByString(gun_type, "Alias", "Shell drop")// * ammo_dataset.getCellByString(ammo_type, "Alias", "Lift");
      // console.log(drop);
      let angle = searchAngle(world_start, world_target, speed, drop);
      let target_dist = dist2D(world_start, world_target);

      // Map canvas
      let mapCanvas = document.getElementById("mapCanvas");
      let mapCtx = mapCanvas.getContext("2d");
      mapCtx.clearRect(0, 0, mapCanvas.width, mapCanvas.height);

      mapCtx.beginPath();
      mapCtx.arc(target_point[0], mapCanvas.height - target_point[1], 10, 0, 2 * Math.PI, false);
      mapCtx.fillStyle = "red";
      mapCtx.fill();
      mapCtx.stroke();

      mapCtx.beginPath();
      mapCtx.arc(start_point[0], mapCanvas.height - start_point[1], 10, 0, 2 * Math.PI, false);
      mapCtx.fillStyle = "blue";
      mapCtx.fill();
      mapCtx.stroke();

      // Arc canvas
      let arcCanvas = document.getElementById("arcCanvas");
      let arcCtx = arcCanvas.getContext("2d");
      arcCtx.clearRect(0, 0, arcCanvas.width, arcCanvas.height);

      let data = getProjectileArc(speed, angle, world_start[2], drop, 0, tAtHit(speed, angle, target_dist), 100);
      for (let i=0; i<data.length-1; i++){
        arcCtx.beginPath();
        arcCtx.moveTo(20 + data[i][0]/arc_scale, arcCanvas.height - data[i][1]/arc_scale);
        arcCtx.lineTo(20 + data[i+1][0]/arc_scale, arcCanvas.height - data[i+1][1]/arc_scale);
        arcCtx.stroke();
      }
      
      arcCtx.beginPath();
      arcCtx.arc(20 + target_dist / arc_scale, arcCanvas.height - target_point[2], 4, 0, 2 * Math.PI, false);
      arcCtx.fillStyle = "red";
      arcCtx.fill();
      arcCtx.stroke();

      arcCtx.beginPath();
      arcCtx.arc(20, arcCanvas.height - start_point[2], 4, 0, 2 * Math.PI, false);
      arcCtx.fillStyle = "blue";
      arcCtx.fill();
      arcCtx.stroke();


      // Draw gun sight angle
      // (angle straight to target) - (angle gun has to aim) = angle in gun sights
      let laser_angle = Math.atan2((world_target[2]-world_start[2]), dist2D(world_start, world_target));
      let angle_diff = angle - laser_angle;

      let gun_image = document.querySelector("#gunImage");
      let gun_image_scale = (gun_image.width / gun_image.naturalWidth);
      

      let gun_sights_start_y = parseInt(crosshair_dataset.getCellByString(gun_type, "Name", "Start y")); // TODO base on gun
      let gun_sights_start_x = parseInt(crosshair_dataset.getCellByString(gun_type, "Name", "Start x"));
      let gun_sights_end_x = parseInt(crosshair_dataset.getCellByString(gun_type, "Name", "End x"));
      let gun_sights_px_per_rad = crosshair_dataset.getCellByString(gun_type, "Name", "Deg per pixel") * Math.PI / 180;
      let gun_sights_aim_y = gun_sights_start_y + angle_diff / gun_sights_px_per_rad;

      let gunCanvas = document.getElementById("gunCanvas");
      let gunCtx = gunCanvas.getContext("2d");
      gunCtx.clearRect(0, 0, gunCanvas.width, gunCanvas.height);
      gunCtx.beginPath();
      gunCtx.strokeStyle = "red";
      gunCtx.lineWidth = 4; 
      gunCtx.moveTo(gun_sights_start_x*gun_image_scale, gun_sights_aim_y*gun_image_scale);
      gunCtx.lineTo(gun_sights_end_x*gun_image_scale, gun_sights_aim_y*gun_image_scale);
      gunCtx.stroke();

      // Update data table
      $("#arcTableTime").text(precise(tAtHit(speed, angle, target_dist), 2) + "s");
      $("#arcTableDistance").text(precise(target_dist, 3) + "m");
      $("#arcTableAngleRel").text(precise(angle_diff * 180 / Math.PI, 2) + "\u00B0");
      $("#arcTableAngleAbs").text(precise(angle * 180 / Math.PI, 2) + "\u00B0");
    }



    function shipFilterSubmitted() {
      let filterType = $("#shipFilterSelect").val();
      let filterMode = $("#shipFilterModeSelect").val() == "Exclude";
      let filterText = $("#shipFilterText").val();

      let dataset = null;
      if (filterType == "All" && !filterMode)
        dataset = ship_dataset;
      else if (filterType == "All" && filterMode)
        dataset = ship_dataset.getEmptyContent();
      else
        dataset = ship_dataset.filterByString(filterText, filterType, filterMode, false);
      setShipTableItems(dataset.getDatasetRows());
      // console.log(filterText, filterType);
      // console.log(ship_dataset.filterByString("", filterType, false, false).getDatasetRows());

    }

    function matchFilterSubmitted() {
      let filterType = $("#matchFilterSelect").val();
      let filterMode = $("#matchFilterModeSelect").val() == "Exclude";
      let filterText = $("#matchFilterText").val();
      let dataset = null;
      if (filterType == "All" && !filterMode)
        dataset = match_dataset;
      else if (filterType == "All" && filterMode)
        dataset = match_dataset.getEmptyContent();
      else if (filterType == "Date after (DDMMYYYY)")
        dataset = match_dataset.filterByDate(filterText, "Date of match", filterMode, true);
      else if (filterType == "Date before (DDMMYYYY)")
        dataset = match_dataset.filterByDate(filterText, "Date of match", filterMode, false);
      else if (filterType == "Ship")
        dataset = match_dataset.filterByStringMultiCol(filterText, ["T1 Ship 1", "T1 Ship 2", "T2 Ship 1", "T2 Ship 2"], filterMode, false);
      else if (filterType == "Pilot")
        dataset = match_dataset.filterByStringMultiCol(filterText, ["T1S1 Pilot", "T1S2 Pilot", "T2S1 Pilot", "T2S2 Pilot"], filterMode, false);
      else
        dataset = match_dataset.filterByString(filterText, filterType, filterMode, false);

      setMatchTableItems(dataset.getDatasetRows());
    }

    

    function setMatchTableItems(rows) {
      $("#matchTable").empty();
      let table_title = $(`
                <tr>
                  <th>Date</th>
                  <th>Event</th>
                  <th>Result</th>
                  <th>T1 Ships</th>
                  <th>T2 Ships</th>
                  <th>T1 Pilots</th>
                  <th>T2 Pilots</th>
                </tr>`);
      $("#matchTable").append(table_title);

      for (let i = 0; i < rows.length; i++) {
        let row = rows[i]
        let match_table_row = $(`
                <tr>
                  <td>` + row[1] + `</td>
                  <td>` + row[2] + `</td>
                  <td>` + row[3] + ":" + row[4] + `</td>
                  <td>` + row[5] + "<br>" + row[6] + `</td>
                  <td>` + row[7] + "<br>" + row[8] + `</td>
                  <td>` + row[9] + "<br>" + row[10] + `</td>
                  <td>` + row[11] + "<br>" + row[12] + `</td>
                </tr>`);
        $("#matchTable").append(match_table_row);
      }
    }

    function setShipTableItems(rows) {
      // let rows = sheet.getDbRowsByString("Stormbreaker", "Ship");
      $("#shipsTable").empty();
      let table_title = $(`
            <tr>
              <th>Ship</th>
              <th>Name</th>
              <th>Gun loadout</th>
              <th>Crew loadouts</th>
              <th>Crew positions</th>
              <th>Strategy</th>
              <th>Strong VS</th>
              <th>Weak VS</th>
            </tr>`);
      $("#shipsTable").append(table_title);

      for (let i = 0; i < rows.length; i++) {
        let row = rows[i]
        let ship_table_div = $(`
            <tr>
              <td rowspan="4">` + row[0] + `</td>
              <td rowspan="4">` + row[1] + `</td>
              <td rowspan="4">` + row[2].replace(/,/gi, "<br>") + `</td>
              <td>` + row[3] + `</td>
              <td>` + row[7] + `</td>
              <td rowspan="4">` + row[11] + `</td>
              <td rowspan="4">` + row[12].replace(/,/gi, "<br>") + `</td>
              <td rowspan="4">` + row[13].replace(/,/gi, "<br>") + `</td>
            </tr>
            <tr>
              <td>` + row[4] + `</td>
              <td>` + row[8] + `</td>
            </tr>
            <tr>
              <td>` + row[5] + `</td>
              <td>` + row[9] + `</td>
            </tr>
            <tr>
              <td>` + row[6] + `</td>
              <td>` + row[10] + `</td>
            </tr>`);

        // $("#shipsTable").append(ship_table_div);
        $("#shipsTable").append(ship_table_div);
      }

    }



    function sidebarLinkClicked() {
      console.log("Sidebar link clicked")
      if ($(this).hasClass("subLink")) {
        $("#sidebar a").not($(this).parent().parent().find("> li > a")).removeClass("active");
        $(this).parent().parent().find("> li > a").addClass("active")
      }
      else {
        $("#sidebar a").removeClass("active");
      }
      $(this).find("> a").addClass("active");

      var div = $($(this).data("show")).show();
      div.siblings("div").hide();
    }


  </script>


</body>

</html>