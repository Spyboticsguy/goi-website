<!DOCTYPE html>
<html lang="en">

<head>
  <title>Best Boats</title>
  <link rel="shortcut icon" href="blimp-icon.png">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">



  <link rel="stylesheet" href="deps/bootstrap.min.css">
  <!-- <script src="deps/jquery-3.4.1.slim.min.js"></script> -->
  <script src="deps/jquery-3.4.1.min.js"></script>
  <script src="deps/popper.min.js"></script>
  <script src="deps/bootstrap.min.js"></script>
  <script src="deps/lz-string.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>
  <script src="https://unpkg.com/darkreader"></script>

  <script src="utils.js"></script>
  <script src="docsapi.js"></script>
  <script src="shipBuildList.js"></script>
  <script src="damageCalculations.js"></script>
  <script src="aimCalculator.js"></script>
  <script src="matchList.js"></script>
  <script src="matchStatistics.js"></script>
  <script src="mapSpawns.js"></script>
  <script src="shipBuilder.js"></script>
  <script src="shipBuilderTranslations.js"></script>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"
    crossorigin="anonymous">

  <script src="jquery-ui.min.js"></script>
  <link rel="stylesheet" href="jquery-ui.min.css">
</head>

<body>


  <div class="wrapper">
    <!-- Sidebar  -->
    <nav id="sidebar">
      <div class="sidebar-header">
        <h3>Guns of Icarus Info</h3>
        <div class="custom-control custom-switch">
          <input type="checkbox" class="custom-control-input" id="darkModeSwitch">
          <label class="custom-control-label" for="darkModeSwitch">DARK MODE</label>
        </div>
        <div>
          Server status
          <i id="connectingIcon" class="fas fa-minus-square" style="color:yellow;"></i>
          <i id="connectedIcon" class="fas fa-check-square" style="color:green;display:none;"></i>
          <i id="noconnectionIcon" class="fas fa-times-circle" style="color:red;display:none;"></i>
        </div>
      </div>
      <div class="sidebar-header collapsed">
        <h3><i class="fas fa-atom"></i></h3>
      </div>

      <ul class="list-unstyled components">

        <li id="matchAnalysisLink" data-show="#matchAnalysis">
          <a href="#matchAnalysis">
            <i class="fas fa-glasses"></i>
            Match history analysis
          </a>
        </li>
        <li id="matchesLink" data-show="#matchDatabase">
          <a href="#matchDatabase">
            <i class="fas fa-book"></i>
            Competative match database
          </a>
        </li>
        <li id="matchSubmissionLink" data-show="#matchSubmission">
          <a href="#matchSubmission">
            <i class="fas fa-pen-nib"></i>
            Submit match to history
          </a>
        </li>

        <li id="buildDatabaseLink" data-show="#buildDatabase">
          <a href="#buildDatabase">
            <i class="fas fa-journal-whills"></i>
            Ship database
          </a>
        </li>
        <li id="shipBuilderLink" data-show="#shipBuilder">
          <a href="#shipBuilder">
            <i class="fas fa-hammer"></i>
            Ship builder
          </a>
        </li>

        <li id="damageCalculatorLink" data-show="#damageCalculator">
          <a href="#damageCalculator" class="active">
            <i class="fas fa-bomb"></i>
            Damage calculator
          </a>
        </li>

        <li id="projectileArcsLink" data-show="#projectileArcs">
          <a href="#projectileArcs">
            <i class="fas fa-meteor"></i>
            Projectile arcs
          </a>
        </li>
        <li id="mapSpawnsLink" data-show="#spawns">
          <a href="#spawns">
            <i class="fas fa-map"></i>
            Maps
          </a>
        </li>
        <li id="aboutLink" data-show="#about">
          <a href="#about">
            <i class="far fa-question-circle"></i>
            About
          </a>
        </li>

      </ul>

    </nav>
    <div class="sticky">
      <div id="loadalert" class="alert alert-info" style="display:block;">
        <strong>Loading... </strong><span></span>
      </div>
    </div>
    <!-- Page Content  -->
    <div id="content" class="container-fluid">

      <!-- Match history analysis -->
      <div id="matchAnalysis" class="content-panel" style="display:none">
        <h1>Match history statistics</h1>
        <div class="input-group" style="width:440px">
          <div class="input-group-prepend">
            <div class="input-group-text">Include matches from</div>
          </div>
          <input type="text" class="form-control" id="graphDateFilterStartText" placeholder="2019-01-01" autocomplete="off">
          <div class="input-group-text">to</div>
          <input type="text" class="form-control" id="graphDateFilterEndText" placeholder="today" autocomplete="off">


        </div>
        <br>

        <div class="row row-margin">
          <div class="col-sm-4">
            <div class="input-group">
              <div class="input-group-prepend small">
                <div class="input-group-text">Ship</div>
              </div>
              <select class="form-control" id="statsShipSelect" autocomplete="off">
                <option>Goldfish</option>
                <option>Junker</option>
                <option>Squid</option>
                <option>Galleon</option>
                <option>Spire</option>
                <option selected>Pyramidion</option>
                <option>Mobula</option>
                <option>Magnate</option>
                <option>Crusader</option>
                <option>Judgement</option>
                <option>Corsair</option>
                <option>Shrike</option>
                <option>Stormbreaker</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-s-3">
            <canvas id="bubbleChart" width="600" height="400"></canvas>
          </div>
        </div>
        <hr>
        <div class="row">
          <div class="col-s-3">
            <canvas id="prChart" width="250" height="250"></canvas>
          </div>
          <div class="col-s-3">
            <canvas id="wlChart" width="250" height="250"></canvas>
          </div>
        </div>
        <hr>
        <div class="row">
          <div class="col-s-5">
            <canvas id="winRatioEnemyChart" width="400" height="400"></canvas>
          </div>
          <div class="col-s-2">
            &nbsp &nbsp &nbsp
          </div>

          <div class="col-s-5">
            <canvas id="winRatioAllyChart" width="400" height="400"></canvas>
          </div>
        </div>
      </div>

      <!-- Match Database -->
      <div id="matchDatabase" class="content-panel" style="display:none">
        <div class="row row-margin">
          <div class="col-sm-6">
            <div class="input-group">
              <div class="input-group-prepend">
                <div class="input-group-text">Filter</div>
              </div>
              <select class="form-control" id="matchFilterModeSelect" autocomplete="off">
                <option>Include</option>
                <option>Exclude</option>
              </select>
              <select class="form-control" id="matchFilterSelect" autocomplete="off">
                <option>All</option>
                <option>Date after (DDMMYYYY)</option>
                <option>Date before (DDMMYYYY)</option>
                <option>Event</option>
                <option>Ship</option>
                <option>Pilot</option>
              </select>
              <input type="text" class="form-control" id="matchFilterText" placeholder="filter substring">
              <!-- <div class="input-group-append">
                  <button id="shipFilterBtn" class="btn btn-primary">Filter</button>
                </div> -->
            </div>
          </div>
        </div>

        <!-- <button id="matchAddFilterBtn" class="btn btn-primary">Add another filter</button> -->
        <div class="row">
          <!-- <div class="col"></div> -->
          <div class="col">
            <table id="matchTable" class="table table-bordered">
            </table>
          </div>
        </div>
      </div>

      <!-- Match Submissions -->
      <div id="matchSubmission" class="content-panel" style="display:none">
        <p>Here you can submit a match to the database.</p>
        <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSf8Fyrz4MRAJ8MoDke7it8zB_ihARWv12TBQMtIKstVY3cGXw/viewform?embedded=true"
          width="640" height="2317" frameborder="0" marginheight="0" marginwidth="0">Loadingâ€¦</iframe>
      </div>


      <!-- Build Database  -->
      <div id="buildDatabase" class="content-panel" style="display:none">
        <div>
          <div class="my-col">
            <div class="input-group" style="width:200px">
              <div class="input-group-prepend small">
                <div class="input-group-text">Name</div>
              </div>
              <input type="text" class="form-control" id="buildFilterName" placeholder="">
            </div>
            <div class="input-group" style="width:200px">
              <div class="input-group-prepend small">
                <div class="input-group-text">Ship</div>
              </div>
              <select class="form-control" id="buildFilterShip" autocomplete="off">
                <option selected>Any</option>
                <option>Goldfish</option>
                <option>Junker</option>
                <option>Squid</option>
                <option>Galleon</option>
                <option>Spire</option>
                <option>Pyramidion</option>
                <option>Mobula</option>
                <option>Magnate</option>
                <option>Crusader</option>
                <option>Judgement</option>
                <option>Corsair</option>
                <option>Shrike</option>
                <option>Stormbreaker</option>
              </select>
            </div>
          </div>
          <div class="my-col">
            <div class="input-group" style="width:250px">
              <div class="input-group-prepend medium">
                <div class="input-group-text">PvE builds</div>
              </div>
              <select class="form-control" id="buildFilterPvE" autocomplete="off">
                <option>Exclude</option>
                <option selected>Include</option>
                <option>Only</option>
              </select>
            </div>
            <div class="input-group" style="width:250px">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Submitted by</div>
              </div>
              <select class="form-control" id="buildFilterAuthor" autocomplete="off">
                <option selected>Anyone</option>
                <option>Me</option>
                <option>Others</option>
              </select>
            </div>
          </div>

          <div class="my-col">
            <div class="input-group" style="width:210px">
              <div class="input-group-prepend small">
                <div class="input-group-text">Sorting</div>
              </div>
              <select class="form-control" id="buildFilterOrder" autocomplete="off">
                <option selected>Votes (Desc.)</option>
                <option>Votes (Asc.)</option>
                <option>Date (new)</option>
                <option>Date (old)</option>
                <option>Alphabetical</option>
              </select>
            </div>
            <!-- <br> -->
            <!-- <button id="buildFilterSubmit" class="btn btn-info" type="button">Update filter/list</button> -->
          </div>
          
          <!-- <div class="my-col">
          </div> -->
        </div>
        <br>
        
        

        <table class="table" style="max-width:1000px" id="buildDatabaseTable">
          <thead>
            <tr>
              <th scope="col" style="width:15px">#</th>
              <th scope="col" style="width:85px">Votes</th>
              <th scope="col" style="width:130px">Name</th>
              <th scope="col" colspan="2" style="width:200px">Ship info</th>
              <th scope="col">Description</th>
              <th scope="col" style="width:85px">Options</th>
            </tr>
          </thead>  
        </table>
        <nav style="margin:auto; width:50%;" id="buildPageNav">
          <ul class="pagination">
            <li class="page-item" id="buildPageNavPrev"><a class="page-link">Previous</a></li>
            <li class="page-item" id="buildPageNavFirst"><a class="page-link">1</a></li>
            <li class="page-item active" id="buildPageNavCurr"><a id="currentBuildPage" class="page-link">[current]</a></li>
            <li class="page-item" id="buildPageNavLast"><a class="page-link">[last]</a></li>
            <li class="page-item" id="buildPageNavNext"><a class="page-link">Next</a></li>
          </ul>
        </nav>

      </div>

      <!-- Ship builder -->
      <div id="shipBuilder" class="content-panel" style="display:none">
        <h3>Ship builder</h3>

        <p>Build can be shared via the current URL or by copying and pasting in the textfield below and pressing
          import/export.</p>
        <div class="input-group">
          <div class="input-group-prepend">
            <div class="input-group-text">Import build</div>
          </div>
          <input type="text" id="shipBuildImportText" class="form-control" placeholder="" autocomplete="off">
          <div class="input-group-append">
            <button id="shipBuildImportButton" class="btn btn-primary" type="button">Import</button>
            <button id="shipBuildExportButton" class="btn btn-info" type="button">Export</button>
          </div>
        </div>



        <br>

        <div class="my-col" id="shipLoadoutGroup">
          <div>
            <div class="my-col">
              <input type="text" id="shipBuildName" class="form-control" placeholder="Build Name" autocomplete="off"
                style="width:200px;margin-bottom:5px;font-weight:bold;">
              <div class="input-group" style="width:200px;">
                <div class="input-group-prepend">
                  <div class="input-group-text">Ship</div>
                </div>
                <select class="form-control" id="shipBuildShipSelection" autocomplete="off">
                  <!-- <option>Mobula</option>       -->
                </select>
              </div>
            </div>
            <div class="my-col">
              <button id="buildSubmitButton" class="btn btn-primary" type="button">Submit to database</button>
            </div>

          </div>


          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="shipBuilderPvECheck" autocomplete="off">
            <label class="form-check-label" for="shipBuilderPvECheck">Use PvE equipment</label>
          </div>
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="shipBuilderDesCheck" autocomplete="off">
            <label class="form-check-label" for="shipBuilderDesCheck">Show description</label>
          </div>


          <div class="my-col" id="buildDescriptionCol" style="width:320px;height:410px;display:none;">
            <!-- <div class="form-group"> -->
            <b>Description</b>
            <textarea class="form-control" id="buildDescriptionArea" style="height:75%" autocomplete="off"></textarea>
            <p>Share link will get large if you use description. To share consider uploading build to database instead.</p>
            <!-- </div> -->
          </div>
          <div class="my-col">


            <div id="weaponSelections">
              <b>Ship Loadout</b>


              <div class="input-group" style="width:420px;">
                <div class="input-group-prepend">
                  <div class="input-group-text">Weapon 1</div>
                </div>
                <select class="form-control" id="shipBuildGun1" autocomplete="off"></select>
                <select class="form-control" autocomplete="off"></select>
              </div>
              <!-- <br> -->
              <div class="input-group" style="width:420px;">
                <div class="input-group-prepend">
                  <div class="input-group-text">Weapon 2</div>
                </div>
                <select class="form-control" id="shipBuildGun2" autocomplete="off"></select>
                <select class="form-control" autocomplete="off"></select>
              </div>
              <!-- <br> -->
              <div class="input-group" style="width:420px;">
                <div class="input-group-prepend">
                  <div class="input-group-text">Weapon 3</div>
                </div>
                <select class="form-control" id="shipBuildGun3" autocomplete="off"></select>
                <select class="form-control" autocomplete="off"></select>
              </div>
              <!-- <br> -->
              <div class="input-group" style="width:420px;">
                <div class="input-group-prepend">
                  <div class="input-group-text">Weapon 4</div>
                </div>
                <select class="form-control" id="shipBuildGun4" autocomplete="off"></select>
                <select class="form-control" autocomplete="off"></select>
              </div>
              <!-- <br> -->
              <div class="input-group" style="width:420px;">
                <div class="input-group-prepend">
                  <div class="input-group-text">Weapon 5</div>
                </div>
                <select class="form-control" id="shipBuildGun5" autocomplete="off"></select>
                <select class="form-control" autocomplete="off"></select>
              </div>
              <!-- <br> -->
              <div class="input-group" style="width:420px;">
                <div class="input-group-prepend">
                  <div class="input-group-text">Weapon 6</div>
                </div>
                <select class="form-control" id="shipBuildGun6" autocomplete="off"></select>
                <select class="form-control" autocomplete="off"></select>
              </div>
            </div>

            <div id="crewLoadouts">
              <b>Crew Loadouts</b>
              <div class="input-group">
                <div class="input-group-prepend">
                </div>

                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/Noclass.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/Pilot.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Gunner.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Engineer.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Noclass.jpg" width="40" height="40"></button></a>
                  </div>
                </div>

                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/Spyglass.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/Spyglass.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Rangefinder.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Claw.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Kerosene.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Moonshine.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Hydrogen.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Vent.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Chute.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Bumpers.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Tar.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Sail.jpg" width="40" height="40"></button></a>
                  </div>
                </div>

                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/Kerosene.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/Spyglass.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Rangefinder.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Claw.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Kerosene.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Moonshine.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Hydrogen.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Vent.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Chute.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Bumpers.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Tar.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Sail.jpg" width="40" height="40"></button></a>
                  </div>
                </div>

                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/Hydrogen.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/Spyglass.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Rangefinder.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Claw.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Kerosene.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Moonshine.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Hydrogen.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Vent.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Chute.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Bumpers.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Tar.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Sail.jpg" width="40" height="40"></button></a>
                  </div>
                </div>

                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/Mallet.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/Mallet.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Spanner.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Pipe.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Failsafe.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Extinguisher.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Chemspray.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Buff.jpg" width="40" height="40"></button></a>
                  </div>
                </div>

                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/Spanner.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/Mallet.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Spanner.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Pipe.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Failsafe.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Extinguisher.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Chemspray.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Buff.jpg" width="40" height="40"></button></a>
                  </div>
                </div>

                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/Extinguisher.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/Mallet.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Spanner.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Pipe.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Failsafe.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Extinguisher.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Chemspray.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Buff.jpg" width="40" height="40"></button></a>
                  </div>
                </div>

                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/Charged.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/Normal.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Lochnagar.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Heavy.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Incendiary.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Burst.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Greased.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Lesmok.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Heatsink.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Charged.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Extended.jpg" width="40" height="40"></button></a>
                  </div>
                </div>

                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/Greased.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/Normal.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Lochnagar.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Heavy.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Incendiary.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Burst.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Greased.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Lesmok.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Heatsink.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Charged.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Extended.jpg" width="40" height="40"></button></a>
                  </div>
                </div>

                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/Lesmok.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/Normal.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Lochnagar.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Heavy.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Incendiary.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Burst.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Greased.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Lesmok.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Heatsink.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Charged.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/Extended.jpg" width="40" height="40"></button></a>
                  </div>
                </div>

                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/MechanizedRebuild.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/MechanizedRebuild.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/SalvoNeutralizer.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/CombustionDampener.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/AdvancedDynaBuff.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/StaticTurret.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/ComponentDisruption.jpg" width="40" height="40"></button></a>
                  </div>
                </div>
                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/LightningDraw.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/LightningDraw.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/ConcussiveBlast.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/MineEjection.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/GigatonBlast.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/ProximalDetonation.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/CataclysmRounds.jpg" width="40" height="40"></button></a>
                  </div>
                </div>
                <div>
                  <button role="button" type="button" class="btn btn-outline-secondary" data-toggle="dropdown">
                    <img src="loadout-images/EngineStabilization.jpg" width="35" height="35" class="rounded">
                  </button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item"><img src="loadout-images/EngineStabilization.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/RushingDrift.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/OversurgeRam.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/AirHorn.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/EnhancedEnvelope.jpg" width="40" height="40"></button></a>
                    <a class="dropdown-item"><img src="loadout-images/TarBomb.jpg" width="40" height="40"></button></a>
                  </div>
                </div>

              </div>
            </div>

          </div>

        </div>



        <div class="my-col img-canvas-container" id="shipContainer">
          <b>Drag or scroll to pan or zoom image.</b>
          <br>
          <img id="shipBuilderImage" class="img" src="ship-images/mob_gundeck_small.png" style="display:none" />
          <canvas id="shipBuilderCanvas" width="600" height="600" style="border-style:solid;">Your browser does not
            support the HTML5 canvas tag.</canvas>
          <canvas id="shipBuilderCanvasOffscreen" width="600" height="600" style="display:none">Your browser does not
            support the HTML5 canvas tag.</canvas>

          <!-- <div id="shipBuildGunSelector" class="btn-group-vertical" role="group">
            <button type="button" class="btn btn-secondary">Left</button>
            <button type="button" class="btn btn-secondary">Middle</button>
            <button type="button" class="btn btn-secondary">Right</button>
          </div> -->

        </div>



        <br>
        <h3>Long range</h3>
        <div class="my-col">
          <br>
          <canvas id="rangeCanvas" width="1000" height="600">Your browser does not support the HTML5 canvas tag.</canvas>
          <!-- <br> -->
          <!-- <div id="rangeMapContainer" class="img-canvas-container">
            <img id="rangeImage" class='img' src="map-images/Dunes.jpg" width="400" height="400" />
            <canvas id="rangeCanvas" width="400" height="400">Your browser does not support the HTML5 canvas tag.</canvas>
            <canvas id="rangeCanvasOffscreen" width="400" height="400" style="display:none">Your browser does not
              support the HTML5 canvas tag.</canvas>
          </div> -->

          <!-- <img class='img' src="ship-images/legend.png" width="114" height="179" /> -->
        </div>




        <br>

        <br>


      </div>


      <!-- Gunnery calculator -->
      <div id="damageCalculator" class="content-panel" style="display:block">
        <h1>Damage numbers</h1>
        <div class="row row-margin">
          <div class="col-sm-4">
            <div class="input-group">
              <div class="input-group-prepend small">
                <div class="input-group-text">Gun</div>
              </div>
              <select class="form-control" id="gunSelect" autocomplete="off">
                <option>Artemis</option>
                <option>Light Flak</option>
                <option>Gatling</option>
                <option>Flamethrower</option>
                <option>Light Carronade</option>
                <option>Harpoon</option>
                <option>Flare</option>
                <option>Mercury</option>
                <option>Mortar</option>
                <option>Banshee</option>
                <option>Mine</option>
                <option>Hades</option>
                <option>Aten Lens Array [Mk. S]</option>
                <option>Heavy Flak Mk. I</option>
                <option>Heavy Flak Mk. II</option>
                <option>Hwatcha</option>
                <option>Heavy Carronade</option>
                <option>Lumberjack</option>
                <option>Minotaur</option>
                <option>Nemesis</option>
              </select>
            </div>
          </div>
        </div>

        <div class="row row-margin" id="damageCalcAmmoInput">
          <div class="col-sm-4">
            <div class="input-group">
              <div class="input-group-prepend small">
                <div class="input-group-text">Ammo</div>
              </div>
              <select class="form-control" id="ammoSelect" autocomplete="off">
                <option>Normal</option>
                <option>Lochnagar</option>
                <option>Heavy</option>
                <option>Incendiary</option>
                <option>Burst</option>
                <option>Greased</option>
                <option>Lesmok</option>
                <option>Heatsink</option>
                <option>Charged</option>
                <option>Extended</option>
              </select>
            </div>
          </div>
        </div>


        <div id="damageCalcCustomAmmoInput" style="display:none">
          <h5>Custom ammo</h5>
          <p>Enter values as multipliers, ie. 1.1 is +10%, 0.9 is -10%.</p>

          <div class="my-col">
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Damage</div>
              </div>
              <input type="text" id="customAmmoInputDamage" class="form-control" placeholder="" autocomplete="off"
                value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Rate of Fire</div>
              </div>
              <input type="text" id="customAmmoInputROF" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Clip size</div>
              </div>
              <input type="text" id="customAmmoInputClipSize" class="form-control" placeholder="" autocomplete="off"
                value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Direct damage</div>
              </div>
              <input type="text" id="customAmmoInputDirectDmg" class="form-control" placeholder="" autocomplete="off"
                value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">AoE damage</div>
              </div>
              <input type="text" id="customAmmoInputAoEDamage" class="form-control" placeholder="" autocomplete="off"
                value="1">
            </div>

          </div>
          <!-- <br> -->
          <div class="my-col">
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Projectile speed</div>
              </div>
              <input type="text" id="customAmmoInputSpeed" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Arming time</div>
              </div>
              <input type="text" id="customAmmoInputArmingTime" class="form-control" placeholder="" autocomplete="off"
                value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Range</div>
              </div>
              <input type="text" id="customAmmoInputRange" class="form-control" placeholder="" autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Jitter</div>
              </div>
              <input type="text" id="customAmmoInputArmingJitter" class="form-control" placeholder="" autocomplete="off"
                value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">AoE radius</div>
              </div>
              <input type="text" id="customAmmoInputAoERadius" class="form-control" placeholder="" autocomplete="off"
                value="1">
            </div>
          </div>

          <div class="my-col">
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Rotation speed</div>
              </div>
              <input type="text" id="customAmmoInputArmingRotationSpeed" class="form-control" placeholder=""
                autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Rotational arcs</div>
              </div>
              <input type="text" id="customAmmoInputArmingRotationalArcs" class="form-control" placeholder=""
                autocomplete="off" value="1">
            </div>

            <br>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Fire modifier</div>
              </div>
              <input type="text" id="customAmmoInputArmingRotationalFireChance" class="form-control" placeholder=""
                autocomplete="off" value="1">
            </div>
            <div class="input-group" style="width:200px;">
              <div class="input-group-prepend medium">
                <div class="input-group-text">Fire damage</div>
              </div>
              <input type="text" id="customAmmoInputArmingRotationalFireDamage" class="form-control" placeholder=""
                autocomplete="off" value="0">
            </div>
          </div>


        </div>

        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="damageCalcCustomAmmoCheck" autocomplete="off">
          <label class="form-check-label" for="damageCalcCustomAmmoCheck">Use testing ammo</label>
        </div>

        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="buffedCheckbox" autocomplete="off">
          <label class="form-check-label" for="buffedCheckbox">Buffed</label>
        </div>

        <div id="laserExtras" style="display:none">
          <div class="form-group form-row align-items-center">
            <label for="distanceRange">Target distance: &nbsp; </label>
            <div>
              <input type="range" min="0" max="1000" step="10" class="form-control-range" id="distanceRange"
                data-textfield="#distanceText">
            </div>
            <div class="col-sm-1">
              <input type="text" class="form-control" placeholder="[0-1123]" id="distanceText" disabled>
            </div>
          </div>

          <div class="form-group form-row align-items-center">
            <label for="distanceRange">Time shooting: &nbsp; &nbsp;</label>
            <div>
              <input type="range" min="0" max="1000" step="0.5" class="form-control-range" id="timeRange"
                data-textfield="#timeText">
            </div>
            <div class="col-sm-1">
              <input type="text" class="form-control" placeholder="[0-1123]" id="timeText" disabled>
            </div>
          </div>
        </div>


        <table id="gunTable" class="fixed table table-bordered">
          <tr>
            <th>Range (m)</th>
            <th>Arming distance (m)</th>
            <th>Seconds / clip (s)</th>
            <th>Clip size</th>
            <th>AOE (m)</th>
          </tr>
          <tbody id="gunContent"></tbody>
        </table>

        <table id="damageTotalTable" class="fixed fist-wide table table-bordered">
          <tr>
            <th class="medium">Damage (primary + secondary)</th>
            <th class="medium">
              Armor
              <br>
              <select id="armorUnitSelect" class="form-control" autocomplete="off">
                <option>HP</option>
                <option>Mallets</option>
                <option>Galleon A.</option>
                <option>Pyramidion A.</option>
                <option>Stormbreaker A.</option>
              </select>
            </th>
            <th class="medium">
              Hull
              <br>
              <select id="hullUnitSelect" class="form-control" autocomplete="off">
                <option>HP</option>
                <option>Galleon H.</option>
                <option>Pyramidion H.</option>
                <option>Stormbreaker H.</option>
              </select>
            </th>
            <th class="medium">
              Balloon
              <br>
              <select id="balloonUnitSelect" class="form-control" autocomplete="off">
                <option>HP</option>
                <option>B. Mallets</option>
                <option>Balloons</option>
              </select>
            </th>
            <th class="medium">
              Component
              <br>
              <select id="componentUnitSelect" class="form-control" autocomplete="off">
                <option>HP</option>
                <option>Mallets</option>
                <option>Light Guns</option>
                <option>Heavy Guns</option>
                <option>Light Engines</option>
                <option>Heavy Engines</option>
              </select>
            </th>
          </tr>
          <tbody id="damageTableContent"></tbody>
        </table>

      </div>

      <!-- Arc calculator -->
      <div id="projectileArcs" class="content-panel" style="display:none">
        <h1>Projectile arcs and aiming</h1>
        <div class="row row-margin">
          <div class="col-sm-4">
            <div class="input-group">
              <div class="input-group-prepend small">
                <div class="input-group-text">Gun</div>
              </div>
              <select class="form-control" id="arcGunSelect" autocomplete="off">
                <option>Lumberjack</option>
                <!-- <option>Hades</option> -->
                <option>Heavy Flak Mk. II</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row row-margin">
          <div class="col-sm-4">
            <div class="input-group">
              <div class="input-group-prepend small">
                <div class="input-group-text">Ammo</div>
              </div>
              <select class="form-control" id="arcAmmoSelect" autocomplete="off">
                <option>Normal</option>
                <option>Lochnagar</option>
                <option>Heavy</option>
                <option>Incendiary</option>
                <option>Burst</option>
                <option>Greased</option>
                <option>Lesmok</option>
                <option>Heatsink</option>
                <option>Charged</option>
                <option>Extended</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row row-margin">
          <div class="col-sm-4">
            <div class="input-group">
              <div class="input-group-prepend small">
                <div class="input-group-text">Map</div>
              </div>
              <select class="form-control" id="arcMapSelect" autocomplete="off">
                <option>Dunes</option>
                <option selected>Fjords</option>
              </select>
            </div>
          </div>
        </div>
        <!-- <h5>Drag the points on either of the first images to change altitudes and distances.</h5>Â¨ -->

        <div class="sbs-container">
          <div id="mapContainer" class="img-canvas-container sbs-column">
            <b>Select ship positions (distance)</b>
            <br>
            <img id="mapImage" class='img' src="map-images/Fjords.jpg" width="400" height="400" />
            <canvas id="mapCanvas" width="400" height="400">Your browser does not support the HTML5 canvas tag.</canvas>
          </div>

          <div class="sbs-column">
            <b>Projectile arc side view. Height changeable.</b>
            <br>
            <canvas id="arcCanvas" width="400" height="400" style="border:1px solid #d3d3d3;">
              Your browser does not support the HTML5 canvas tag.</canvas>
          </div>
        </div>


        <div class="sbs-container">
          <div class="sbs-column">

            <b>Gunner view, aim with the red line</b>
            <br>
            <div id="gunContainer" class="img-canvas-container column">
              <img id="gunImage" class='img' src="gun-images/lumberjack.jpg" width="334" height="400" />
              <canvas id="gunCanvas" width="334" height="400">
                Your browser does not support the HTML5 canvas tag.</canvas>
            </div>
          </div>

          <div class="sbs-column">
            <b>Data</b>
            <table id="arcDataTable" class="fixed table table-bordered">
              <tr>
                <th class="medium">Time to hit</th>
                <td id="arcTableTime">10m</td>
              </tr>
              <tr>
                <th class="medium">Distance</th>
                <td id="arcTableDistance">10s</td>
              </tr>
              <tr>
                <th class="medium">Aim angle over target</th>
                <td id="arcTableAngleRel">10</td>
              </tr>
              <tr>
                <th class="medium">Aim angle over horizon</th>
                <td id="arcTableAngleAbs">10</td>
              </tr>
            </table>
          </div>
        </div>
      </div>

      <div id="spawns" class="content-panel" style="display:none">
        <div class="input-group" style="width:400px;">
          <div class="input-group-prepend">
            <div class="input-group-text">Map</div>
          </div>
          <select class="form-control" id="spawnMapSelect" autocomplete="off">
          </select>
          <div class="input-group-append">
            <button id="randomMapButton" class="btn btn-primary">Randomize map</button>
          </div>
        </div>

        <img id="spawnImage" src="" width="700" height="700">
        <p>Credit to Nerdhector for creating spawn position images.</p>
      </div>

      <!-- About -->
      <div id="about" class="content-panel" style="display:none">
        <h3>About</h3>
        <p>
          Database can be found here: <br><a href="https://docs.google.com/spreadsheets/d/1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g/edit?usp=sharing">https://docs.google.com/spreadsheets/d/1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g/edit?usp=sharing</a>.
        </p>
        <p>
          Contact: <br> jjeessppeer+GoI@gmail.com
        </p>
        <p>Please send an email or a discord message if you feel like you know something cool that could be added to
          the site.</p>
        <p>
          If you for some reason wanna see the source i can send you a link.
        </p>
      </div>


    </div>


  </div>


  <script>
    var datasets_loaded = false;

    var match_dataset = null;
    var gun_dataset = null;
    var ammo_dataset = null;
    var damage_dataset = null;
    var ship_dataset = null;
    var tool_dataset = null;
    var component_dataset = null;
    var crosshair_dataset = null;
    var map_dataset = null;
    var ship_guns_dataset = null;

    var server_adress = "http://79.136.70.98:3231";


    var google_sheet_id = "1Oo1-3ad5_8srmHnc_sUpxgF11kxsapyGs8ogd5cR46g";
    // var google_sheet_id = "1g717ASduXJbQbBnLtQgMpHnskY_krj9KSThDfeGTS-4"; // Testing datasheet
    $(document).ready(function () {
      
      $("#sidebar a").on("click", openPageFromUrl);

      // Setup dark mode
      let dark_mode_switch = $("#darkModeSwitch");
      dark_mode_switch.on("change", function() {
        if (this.checked){
          DarkReader.enable({brightness: 100, contrast: 100});
          document.cookie = "dark_mode=true";
        }
        else{
          DarkReader.disable();
          document.cookie = "dark_mode=false";
        }
        updateShipBuildImage();
        updateRangeVis();
      });
      // console.log("COOKIE: ", getCookie("dark_mode")=="true")
      dark_mode_switch.prop("checked", getCookie("dark_mode")=="true");
      dark_mode_switch.trigger("change");
      $("[data-show='#" + window.location.hash.substr(1).split("?")[0] + "'] > a").trigger("click");
      
      // Check server status
      httpxGetRequest(server_adress+"/ping",
        () => {
          $("#connectingIcon").hide();
          $("#connectedIcon").show();
        },
        () => {
          $("#connectingIcon").hide();
          $("#noconnectionIcon").show();
        });
      // Load datasets
      loadDatasetsFromServer();

    });

    function loadDatasetsFromGoogleSheets(){
      $("#loadalert span").text("Server timeout, loading from google instead");
      console.log("Loading datasets from google.")
      loadDatasetFromSheet(google_sheet_id, 2, function (dataset) {
        dataset.sortDatasetContent("Date of match", Date.parse);
        match_dataset = dataset;
      });
      loadDatasetFromSheet(google_sheet_id, 4, function (dataset) {
        gun_dataset = dataset;
      });
      loadDatasetFromSheet(google_sheet_id, 5, function (dataset) {
        ammo_dataset = dataset;
      });
      loadDatasetFromSheet(google_sheet_id, 6, function (dataset) {
        damage_dataset = dataset;
      });
      loadDatasetFromSheet(google_sheet_id, 7, function (dataset) {
        tool_dataset = dataset;
      });
      loadDatasetFromSheet(google_sheet_id, 8, function (dataset) {
        component_dataset = dataset;
      });
      loadDatasetFromSheet(google_sheet_id, 9, function (dataset) {
        ship_dataset = dataset;
      });
      loadDatasetFromSheet(google_sheet_id, 10, function (dataset) {
        map_dataset = dataset;
      });
      loadDatasetFromSheet(google_sheet_id, 11, function (dataset) {
        crosshair_dataset = dataset;
      });
      loadDatasetFromSheet(google_sheet_id, 12, function (dataset) {
        ship_guns_dataset = dataset;
      });
      datasetLoadCheck();
    }

    function datasetLoadCheck(){
      if (!(match_dataset && gun_dataset && ammo_dataset &&
          damage_dataset && tool_dataset && component_dataset &&
          ship_dataset && map_dataset && crosshair_dataset &&
          ship_guns_dataset)) {
          setTimeout(datasetLoadCheck, 200);
          return;
      }
      console.log("Datasets loaded from google.");
      datasetsLoaded();
    }

    function loadDatasetsFromServer(){
      $("#loadalert span").text("Getting datasets");

      // Load datasets from server. On timeout load from google.
      httpxGetRequest(server_adress+"/get_datasets", function(){
        if(datasets_loaded) return;
        if (this.status == 200)
        if (this.readyState == 4 && this.status == 200){
          datasets_loaded = true;
          console.log("Datasets loaded from server");
          let datasets = JSON.parse(this.response);
          // console.log(this.response);
          console.log(datasets);

          match_dataset = jsonToDataset(datasets.history, 
              ["Timestamp","Date of match","Event",
              "Team scores [Team 1 score]","Team scores [Team 2 score]",
              "T1 Ship 1","T1 Ship 2","T2 Ship 1","T2 Ship 2",
              "T1S1 Pilot","T1S2 Pilot","T2S1 Pilot","T2S2 Pilot",
              "VOD link (optional)","Map"]);
          match_dataset.sortDatasetContent("Date of match", Date.parse);
          
          ammo_dataset = jsonToDataset(datasets.ammo_stats,
              ["Name","Alias","Rotation speed","Jitter","Clip size",
              "AOE radius","AOE damage","Damage","Arming time","Rate of fire",
              "Projectile speed","Fire modifier","Fire damage","Lift","Direct damage",
              "Range","Rotational arcs"]);
          
          gun_dataset = jsonToDataset(datasets.gun_stats,
              ["Name","Alias","Mode","Weapon slot","Damage type primary",
              "Damage primary","Damage type secondary","Damage secondary",
              "Rate of fire","Reload time","Magazine size","Fire primary",
              "Fire secondary","Projectile speed","Range","Shell drop","AOE radius",
              "Buckshot","Arming time","Side angle","Up angle","Down angle"]);
          
          ship_dataset = jsonToDataset(datasets.ship_stats, 
              ["Ship Type","Armor","Armor Rebuild Value","Hull Health",
              "Light Weapons","Heavy Weapons","Longitudinal Speed, (m/s)",
              "Longitudinal Acceleration, (m/sÂ²)","Turn Speed, (deg/s)",
              "Turn Acceleration,(deg/sÂ²)","Vertical Speed, (m/s)",
              "Vertical Acceleration, (m/sÂ²)","Mass, (t)"]);

          damage_dataset = jsonToDataset(datasets.damage_stats, 
              ["Name", "Balloon", "Hull", "Armor", "Components"]);
          
          component_dataset = jsonToDataset(datasets.component_stats, 
              ["Name", "HP"]);

          tool_dataset = jsonToDataset(datasets.tool_stats, 
              ["Name", "Repair", "Rebuild", "Extinguish", "Fire immunity", "Cooldown"]);

          crosshair_dataset = jsonToDataset(datasets.crosshair_data, 
              ["Name", "Deg per pixel", "Start y", "Start x", "End x", "Image"]);

          ship_guns_dataset = jsonToDataset(datasets.ships_gun_angles, 
              ["Ship","N guns",
              "Angle 1","Angle 2","Angle 3","Angle 4","Angle 5","Angle 6",
              "Position 1","Position 2","Position 3","Position 4","Position 5","Position 6",
              "Slot 1","Slot 2","Slot 3","Slot 4","Slot 5","Slot 6"]);

          map_dataset = jsonToDataset(datasets.map_data, 
              ["Name", "Full name", "Game mode", 
              "Map image", "Image src", "Spawn image src", "Map scale (m/px)"]);
          
          console.log("Datasets loaded from server.");
          datasetsLoaded();
        }
      }, loadDatasetsFromGoogleSheets);
    }

    function datasetsLoaded() {
      datasets_loaded = true;
      $("#loadalert").slideUp();
      initializeDamageCalculator();
      initializeAimCalculator();
      initializeShipBuilder();
      initializeMatchStatistics();
      initializeSpawns();
      initializeMatchList();
      initializeBuildList();
    }

    function openPageFromUrl() {
      let tab_href = $(this).attr('href').split("?")[0];
      $("#sidebar a").removeClass("active");
      $("#sidebar [data-show='"+tab_href+"'] > a").addClass("active");
      var div = $(tab_href).show();
      div.siblings("div").hide();
    }


  </script>


</body>

</html>